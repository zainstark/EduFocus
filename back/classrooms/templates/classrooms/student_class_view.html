{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ classroom.name }} - Student View</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <!-- Class Info -->
    <div class="card mb-4">
        <div class="card-body">
            <h1>{{ classroom.name }}</h1>
            <p><strong>Instructor:</strong> {{ classroom.instructor.full_name }}</p>
            <p>{{ classroom.description|default:"No description" }}</p>
        </div>
    </div>

    <!-- Performance Overview -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <h5>Number of Sessions</h5>
                    <h3>{{ sessions.count }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <h5>Sessions Attended</h5>
                    <h3>{{ my_performance|length }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <h5>Last Session Performance</h5>
                    <h3>
                        {% if last_session_perf %}
                            {{ last_session_perf.focus_score|default:"N/A" }}%
                        {% else %}
                            N/A
                        {% endif %}
                    </h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Focus Performance Graph -->
    <div class="card">
        <div class="card-header">
            <h4>Average Focus Performance Per Session</h4>
        </div>
        <div class="card-body">
            <canvas id="focusChart" height="120"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('focusChart').getContext('2d');
const focusChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: {{ performance_labels_json|safe }},
        datasets: [{
            label: 'Focus %',
            data: {{ performance_data_json|safe }},
            borderColor: '#0d6efd',
            fill: false
        }]
    },
    options: { responsive: true, scales: { y: { beginAtZero: true, max: 100 } } }
});
</script>
</body>
</html>
<script>
// Pass tokens from Django context to localStorage
const accessToken = "{{ access_token }}";
const refreshToken = "{{ refresh_token }}";

if (accessToken) {
    localStorage.setItem('access_token', accessToken);
    localStorage.setItem('refresh_token', refreshToken);
}
</script>